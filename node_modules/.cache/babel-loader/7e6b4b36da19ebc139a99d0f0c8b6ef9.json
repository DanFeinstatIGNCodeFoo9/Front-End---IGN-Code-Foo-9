{"ast":null,"code":"import _toConsumableArray from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/src/components/feed/Feed.js\";\nimport React, { Component, Fragment } from \"react\";\nimport { Transition, animated, config } from \"react-spring/renderprops\";\nimport FeedItem from \"../feedItem/FeedItem\";\nimport moment from \"moment\";\n\nvar Feed =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Feed, _Component);\n\n  function Feed(props) {\n    var _this;\n\n    _classCallCheck(this, Feed);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Feed).call(this, props));\n\n    _this.fetchCommentNumber = function () {\n      var commentsurl = \"https://ign-apis.herokuapp.com/comments?ids=\";\n\n      for (var i = _this.state.startIndex - 20; i < _this.state.startIndex; i++) {\n        if (i + 1 === _this.state.startIndex) {\n          commentsurl += \"\".concat(_this.state.content[i].id);\n        } else {\n          commentsurl += \"\".concat(_this.state.content[i].id, \",\");\n        }\n      }\n\n      var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n      fetch(proxyurl + commentsurl).then(function (res) {\n        return res.json();\n      }).then(function (results) {\n        var newComments = results.content;\n\n        _this.setState(function (state) {\n          return {\n            comments: [].concat(_toConsumableArray(state.comments), _toConsumableArray(newComments)),\n            fetchingComments: false\n          };\n        });\n      });\n    };\n\n    _this.loadArticles = function () {\n      if (!_this.state.fetchingComments) {\n        _this.setState({\n          isLoading: true\n        }, function () {\n          //The api given returns a access-cross-origin-header error.\n          //Therefore I'm using a proxy to convince the api it is sending the data to itself.\n          //I know this is a bit hacky and if I have time after building all the projects I'll try for a more elegant solution.\n          var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n          console.log(proxyurl + \"https://ign-apis.herokuapp.com/content?startIndex=\".concat(_this.state.startIndex, \"&count=20\"));\n          fetch(proxyurl + \"https://ign-apis.herokuapp.com/content?startIndex=\".concat(_this.state.startIndex, \"&count=20\")) // .then(res => console.log(res));\n          .then(function (res) {\n            return res.json();\n          }).then(function (results) {\n            console.log(results.data);\n            moment.updateLocale(\"en\", {\n              relativeTime: {\n                future: \"in %s\",\n                past: \"%s\",\n                s: function s(number, withoutSuffix, key, isFuture) {\n                  return number + \"s\";\n                },\n                m: \"1m\",\n                mm: function mm(number, withoutSuffix, key, isFuture) {\n                  return number + \"m\";\n                },\n                h: \"1h\",\n                hh: \"%dh\",\n                d: \"1d\",\n                dd: \"%dd\",\n                M: \"1m\",\n                MM: \"%dm\",\n                y: \"1y\",\n                yy: \"%dy\"\n              }\n            });\n            var newContent = results.data.map(function (content) {\n              return {\n                id: content.contentId,\n                contentType: content.contentType,\n                img: content.thumbnails[0],\n                title: content.metadata.headline,\n                description: content.metadata.description,\n                //   publishDate: content.metadata.publishDate,\n                publishDate: moment(content.metadata.publishDate).fromNow(),\n                comments: null\n              };\n            });\n            console.log(results.data[0].thumbnails[0].url);\n            var nextArticles = [];\n            var nextVideos = [];\n\n            for (var i = 0; i < newContent.length; i++) {\n              if (newContent[i].contentType === \"article\") {\n                nextArticles.push(newContent[i]);\n              } else if (newContent[i].contentType === \"video\") {\n                nextVideos.push(newContent[i]);\n              }\n            }\n\n            _this.setState(function (state) {\n              return {\n                hasMore: state.content.length < 300,\n                isLoading: false,\n                startIndex: state.startIndex + 20,\n                content: [].concat(_toConsumableArray(state.content), _toConsumableArray(newContent)),\n                articles: [].concat(_toConsumableArray(state.articles), nextArticles),\n                videos: [].concat(_toConsumableArray(state.videos), nextVideos),\n                fetchingComments: true\n              };\n            }, function () {\n              _this.fetchCommentNumber();\n            });\n          }).catch(function (err) {\n            _this.setState({\n              err: err.message,\n              isLoading: false\n            });\n          });\n        });\n      }\n    };\n\n    _this.state = {\n      error: false,\n      hasMore: true,\n      isLoading: false,\n      startIndex: 0,\n      //   startIndexArticles: 0,\n      //   startIndexVideos: 0,\n      content: [],\n      articles: [],\n      videos: [],\n      toDisplay: [],\n      comments: [],\n      fetchingComments: false\n    };\n\n    window.onscroll = function () {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          loadArticles = _assertThisInitialize.loadArticles,\n          _assertThisInitialize2 = _assertThisInitialize.state,\n          error = _assertThisInitialize2.error,\n          isLoading = _assertThisInitialize2.isLoading,\n          hasMore = _assertThisInitialize2.hasMore;\n\n      if (error || isLoading || !hasMore) return;\n\n      if (window.innerHeight + document.documentElement.scrollTop >= document.documentElement.offsetHeight - 60) {\n        loadArticles();\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Feed, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadArticles();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevState, prevProps) {\n      var _this2 = this;\n\n      if (prevState.filter !== this.props.filter || prevProps.startIndex !== this.state.startIndex) {\n        setTimeout(function () {\n          var newDisplay = _this2.props.filter === \"latest\" ? _toConsumableArray(_this2.state.content) : _toConsumableArray(_this2.state[_this2.props.filter]);\n\n          _this2.setState({\n            toDisplay: newDisplay\n          });\n        }, 300);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          error = _this$state.error,\n          hasMore = _this$state.hasMore,\n          isLoading = _this$state.isLoading,\n          content = _this$state.content,\n          articles = _this$state.articles,\n          videos = _this$state.videos,\n          comments = _this$state.comments;\n      return (//     <Transition\n        //     items={this.props.filter}\n        //     from={{ opacity: 0 }}\n        //     enter={{ opacity: 1 }}\n        //     leave={{ opacity: 0 }}\n        //     config={config.stiff}\n        //   >\n        //     {show =>\n        //       show &&\n        //       (props => (\n        //         <div style={props}>\n        //           {this.state.toDisplay.map(video => (\n        //             <Fragment key={video.id}>\n        //               <FeedItem\n        //                 id={video.id}\n        //                 date={video.publishDate}\n        //                 img={video.img}\n        //                 title={video.title}\n        //                 description={video.description}\n        //                 comments={comments}\n        //                 filter={this.props.filter}\n        //               />\n        //             </Fragment>\n        //           ))}\n        //         </div>\n        //       ))\n        //     }\n        //   </Transition>\n        React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        }, this.props.filter === \"videos\" ? React.createElement(Transition, {\n          items: this.props.vidFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 217\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 227\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (video) {\n              return React.createElement(Fragment, {\n                key: video.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 229\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: video.id,\n                date: video.publishDate,\n                img: video.img,\n                title: video.title,\n                description: video.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 230\n                },\n                __self: this\n              }));\n            }));\n          };\n        }) : this.props.filter === \"articles\" ? React.createElement(Transition, {\n          items: this.props.artFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 256\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (article) {\n              return React.createElement(Fragment, {\n                key: article.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 258\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: article.id,\n                date: article.publishDate,\n                img: article.img,\n                title: article.title,\n                description: article.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 259\n                },\n                __self: this\n              }));\n            }));\n          };\n        }) : React.createElement(Transition, {\n          items: this.props.vidFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 275\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 285\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (content) {\n              return React.createElement(Fragment, {\n                key: content.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 287\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: content.id,\n                date: content.publishDate,\n                img: content.img,\n                title: content.title,\n                description: content.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 288\n                },\n                __self: this\n              }));\n            }));\n          };\n        }), error && React.createElement(\"div\", {\n          style: {\n            color: \"#900\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 304\n          },\n          __self: this\n        }, error), isLoading && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 305\n          },\n          __self: this\n        }, \"Loading...\"), !hasMore && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306\n          },\n          __self: this\n        }, \"No more content!\"))\n      );\n    }\n  }]);\n\n  return Feed;\n}(Component);\n\nexport default Feed;","map":{"version":3,"sources":["/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/src/components/feed/Feed.js"],"names":["React","Component","Fragment","Transition","animated","config","FeedItem","moment","Feed","props","fetchCommentNumber","commentsurl","i","state","startIndex","content","id","proxyurl","fetch","then","res","json","results","newComments","setState","comments","fetchingComments","loadArticles","isLoading","console","log","data","updateLocale","relativeTime","future","past","s","number","withoutSuffix","key","isFuture","m","mm","h","hh","d","dd","M","MM","y","yy","newContent","map","contentId","contentType","img","thumbnails","title","metadata","headline","description","publishDate","fromNow","url","nextArticles","nextVideos","length","push","hasMore","articles","videos","catch","err","message","error","toDisplay","window","onscroll","innerHeight","document","documentElement","scrollTop","offsetHeight","prevState","prevProps","filter","setTimeout","newDisplay","vidFilter","opacity","stiff","show","video","artFilter","article","color"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { Transition, animated, config } from \"react-spring/renderprops\";\n\nimport FeedItem from \"../feedItem/FeedItem\";\nimport moment from \"moment\";\n\nclass Feed extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      error: false,\n      hasMore: true,\n      isLoading: false,\n      startIndex: 0,\n      //   startIndexArticles: 0,\n      //   startIndexVideos: 0,\n      content: [],\n      articles: [],\n      videos: [],\n      toDisplay: [],\n      comments: [],\n      fetchingComments: false,\n    };\n\n    window.onscroll = () => {\n      const {\n        loadArticles,\n        state: { error, isLoading, hasMore },\n      } = this;\n\n      if (error || isLoading || !hasMore) return;\n\n      if (\n        window.innerHeight + document.documentElement.scrollTop >=\n        document.documentElement.offsetHeight - 60\n      ) {\n        loadArticles();\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.loadArticles();\n  }\n\n  componentDidUpdate(prevState, prevProps) {\n    if (\n      prevState.filter !== this.props.filter ||\n      prevProps.startIndex !== this.state.startIndex\n    ) {\n      setTimeout(() => {\n        let newDisplay =\n          this.props.filter === `latest`\n            ? [...this.state.content]\n            : [...this.state[this.props.filter]];\n        this.setState({\n          toDisplay: newDisplay,\n        });\n      }, 300);\n    }\n  }\n\n  fetchCommentNumber = () => {\n    let commentsurl = `https://ign-apis.herokuapp.com/comments?ids=`;\n    for (let i = this.state.startIndex - 20; i < this.state.startIndex; i++) {\n      if (i + 1 === this.state.startIndex) {\n        commentsurl += `${this.state.content[i].id}`;\n      } else {\n        commentsurl += `${this.state.content[i].id},`;\n      }\n    }\n    const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n    fetch(proxyurl + commentsurl)\n      .then(res => res.json())\n      .then(results => {\n        const newComments = results.content;\n\n        this.setState(state => ({\n          comments: [...state.comments, ...newComments],\n          fetchingComments: false,\n        }));\n      });\n  };\n\n  loadArticles = () => {\n    if (!this.state.fetchingComments) {\n      this.setState({ isLoading: true }, () => {\n        //The api given returns a access-cross-origin-header error.\n        //Therefore I'm using a proxy to convince the api it is sending the data to itself.\n        //I know this is a bit hacky and if I have time after building all the projects I'll try for a more elegant solution.\n        const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n        console.log(\n          proxyurl +\n            `https://ign-apis.herokuapp.com/content?startIndex=${\n              this.state.startIndex\n            }&count=20`\n        );\n        fetch(\n          proxyurl +\n            `https://ign-apis.herokuapp.com/content?startIndex=${\n              this.state.startIndex\n            }&count=20`\n        )\n          // .then(res => console.log(res));\n          .then(res => res.json())\n          .then(results => {\n            console.log(results.data);\n\n            moment.updateLocale(\"en\", {\n              relativeTime: {\n                future: \"in %s\",\n                past: \"%s\",\n                s: function(number, withoutSuffix, key, isFuture) {\n                  return number + \"s\";\n                },\n                m: \"1m\",\n                mm: function(number, withoutSuffix, key, isFuture) {\n                  return number + \"m\";\n                },\n                h: \"1h\",\n                hh: \"%dh\",\n                d: \"1d\",\n                dd: \"%dd\",\n                M: \"1m\",\n                MM: \"%dm\",\n                y: \"1y\",\n                yy: \"%dy\",\n              },\n            });\n            let newContent = results.data.map(content => ({\n              id: content.contentId,\n              contentType: content.contentType,\n              img: content.thumbnails[0],\n              title: content.metadata.headline,\n              description: content.metadata.description,\n              //   publishDate: content.metadata.publishDate,\n              publishDate: moment(content.metadata.publishDate).fromNow(),\n              comments: null,\n            }));\n            console.log(results.data[0].thumbnails[0].url);\n            let nextArticles = [];\n            let nextVideos = [];\n            for (let i = 0; i < newContent.length; i++) {\n              if (newContent[i].contentType === \"article\") {\n                nextArticles.push(newContent[i]);\n              } else if (newContent[i].contentType === \"video\") {\n                nextVideos.push(newContent[i]);\n              }\n            }\n            this.setState(\n              state => ({\n                hasMore: state.content.length < 300,\n                isLoading: false,\n                startIndex: state.startIndex + 20,\n                content: [...state.content, ...newContent],\n                articles: [...state.articles, ...nextArticles],\n                videos: [...state.videos, ...nextVideos],\n                fetchingComments: true,\n              }),\n              () => {\n                this.fetchCommentNumber();\n              }\n            );\n          })\n          .catch(err => {\n            this.setState({\n              err: err.message,\n              isLoading: false,\n            });\n          });\n      });\n    }\n  };\n\n  render() {\n    const {\n      error,\n      hasMore,\n      isLoading,\n      content,\n      articles,\n      videos,\n      comments,\n    } = this.state;\n    return (\n      //     <Transition\n      //     items={this.props.filter}\n      //     from={{ opacity: 0 }}\n      //     enter={{ opacity: 1 }}\n      //     leave={{ opacity: 0 }}\n      //     config={config.stiff}\n      //   >\n      //     {show =>\n      //       show &&\n      //       (props => (\n      //         <div style={props}>\n      //           {this.state.toDisplay.map(video => (\n      //             <Fragment key={video.id}>\n      //               <FeedItem\n      //                 id={video.id}\n      //                 date={video.publishDate}\n      //                 img={video.img}\n      //                 title={video.title}\n      //                 description={video.description}\n      //                 comments={comments}\n      //                 filter={this.props.filter}\n      //               />\n      //             </Fragment>\n      //           ))}\n      //         </div>\n      //       ))\n      //     }\n      //   </Transition>\n      <div>\n        {this.props.filter === `videos` ? (\n          <Transition\n            items={this.props.vidFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(video => (\n                    <Fragment key={video.id}>\n                      <FeedItem\n                        id={video.id}\n                        date={video.publishDate}\n                        img={video.img}\n                        title={video.title}\n                        description={video.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        ) : this.props.filter === `articles` ? (\n          <Transition\n            items={this.props.artFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(article => (\n                    <Fragment key={article.id}>\n                      <FeedItem\n                        id={article.id}\n                        date={article.publishDate}\n                        img={article.img}\n                        title={article.title}\n                        description={article.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        ) : (\n          <Transition\n            items={this.props.vidFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(content => (\n                    <Fragment key={content.id}>\n                      <FeedItem\n                        id={content.id}\n                        date={content.publishDate}\n                        img={content.img}\n                        title={content.title}\n                        description={content.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        )}\n        {error && <div style={{ color: \"#900\" }}>{error}</div>}\n        {isLoading && <div>Loading...</div>}\n        {!hasMore && <div>No more content!</div>}\n      </div>\n    );\n  }\n}\n\nexport default Feed;\n"]},"metadata":{},"sourceType":"module"}