{"ast":null,"code":"import _toConsumableArray from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/src/components/feed/Feed.js\";\nimport React, { Component, Fragment } from \"react\";\nimport { Transition, animated, config } from \"react-spring/renderprops\";\nimport FeedItem from \"../feedItem/FeedItem\";\nimport moment from \"moment\";\n\nvar Feed =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Feed, _Component);\n\n  function Feed(props) {\n    var _this;\n\n    _classCallCheck(this, Feed);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Feed).call(this, props));\n\n    _this.fetchCommentNumber = function () {\n      var commentsurl = \"https://ign-apis.herokuapp.com/comments?ids=\";\n\n      for (var i = _this.state.startIndex - 20; i < _this.state.startIndex; i++) {\n        if (i + 1 === _this.state.startIndex) {\n          commentsurl += \"\".concat(_this.state.content[i].id);\n        } else {\n          commentsurl += \"\".concat(_this.state.content[i].id, \",\");\n        }\n      }\n\n      var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n      fetch(proxyurl + commentsurl).then(function (res) {\n        return res.json();\n      }).then(function (results) {\n        var newComments = results.content;\n\n        _this.setState(function (state) {\n          return {\n            comments: [].concat(_toConsumableArray(state.comments), _toConsumableArray(newComments)),\n            fetchingComments: false\n          };\n        });\n      });\n    };\n\n    _this.reformatDuration = function (dur) {\n      var remainder = dur % 60;\n      var min = (dur - remainder) / 60;\n\n      if (remainder.length < 2) {\n        return \"\".concat(min, \":0\").concat(remainder);\n      } else {\n        return \"\".concat(min, \":0\").concat(remainder);\n      }\n    };\n\n    _this.loadArticles = function () {\n      if (!_this.state.fetchingComments) {\n        _this.setState({\n          isLoading: true\n        }, function () {\n          //The api given returns a access-cross-origin-header error.\n          //Therefore I'm using a proxy to convince the api it is sending the data to itself.\n          //I know this is a bit hacky and if I have time after building all the projects I'll try for a more elegant solution.\n          var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n          console.log(proxyurl + \"https://ign-apis.herokuapp.com/content?startIndex=\".concat(_this.state.startIndex, \"&count=20\"));\n          fetch(proxyurl + \"https://ign-apis.herokuapp.com/content?startIndex=\".concat(_this.state.startIndex, \"&count=20\")) // .then(res => console.log(res));\n          .then(function (res) {\n            return res.json();\n          }).then(function (results) {\n            console.log(results.data);\n            moment.updateLocale(\"en\", {\n              relativeTime: {\n                future: \"in %s\",\n                past: \"%s\",\n                s: function s(number, withoutSuffix, key, isFuture) {\n                  return number + \"s\";\n                },\n                m: \"1m\",\n                mm: function mm(number, withoutSuffix, key, isFuture) {\n                  return number + \"m\";\n                },\n                h: \"1h\",\n                hh: \"%dh\",\n                d: \"1d\",\n                dd: \"%dd\",\n                M: \"1m\",\n                MM: \"%dm\",\n                y: \"1y\",\n                yy: \"%dy\"\n              }\n            });\n            var newContent = results.data.map(function (content) {\n              return {\n                id: content.contentId,\n                contentType: content.contentType,\n                img: content.thumbnails[0].url ? content.thumbnails[0].url : \"placeholder\",\n                title: content.metadata.headline,\n                description: content.metadata.title,\n                duration: content.metadata.duration ? _this.reformatDuration(content.metadata.duration) : null,\n                //   publishDate: content.metadata.publishDate,\n                publishDate: moment(content.metadata.publishDate).fromNow(),\n                comments: null\n              };\n            });\n            console.log(results.data[0].thumbnails[0].url);\n            var nextArticles = [];\n            var nextVideos = [];\n\n            for (var i = 0; i < newContent.length; i++) {\n              if (newContent[i].contentType === \"article\") {\n                nextArticles.push(newContent[i]);\n              } else if (newContent[i].contentType === \"video\") {\n                nextVideos.push(newContent[i]);\n              }\n            }\n\n            _this.setState(function (state) {\n              return {\n                hasMore: state.content.length < 300,\n                isLoading: false,\n                startIndex: state.startIndex + 20,\n                content: [].concat(_toConsumableArray(state.content), _toConsumableArray(newContent)),\n                articles: [].concat(_toConsumableArray(state.articles), nextArticles),\n                videos: [].concat(_toConsumableArray(state.videos), nextVideos),\n                fetchingComments: true\n              };\n            }, function () {\n              _this.fetchCommentNumber();\n            });\n          }).catch(function (err) {\n            _this.setState({\n              err: err.message,\n              isLoading: false\n            });\n          });\n        });\n      }\n    };\n\n    _this.state = {\n      error: false,\n      hasMore: true,\n      isLoading: false,\n      startIndex: 0,\n      //   startIndexArticles: 0,\n      //   startIndexVideos: 0,\n      content: [],\n      articles: [],\n      videos: [],\n      toDisplay: [],\n      comments: [],\n      fetchingComments: false\n    };\n\n    window.onscroll = function () {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          loadArticles = _assertThisInitialize.loadArticles,\n          _assertThisInitialize2 = _assertThisInitialize.state,\n          error = _assertThisInitialize2.error,\n          isLoading = _assertThisInitialize2.isLoading,\n          hasMore = _assertThisInitialize2.hasMore;\n\n      if (error || isLoading || !hasMore) return;\n\n      if (window.innerHeight + document.documentElement.scrollTop >= document.documentElement.offsetHeight - 60) {\n        loadArticles();\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Feed, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadArticles();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevState, prevProps) {\n      var _this2 = this;\n\n      if (prevState.filter !== this.props.filter || prevProps.startIndex !== this.state.startIndex) {\n        setTimeout(function () {\n          var newDisplay = _this2.props.filter === \"latest\" ? _toConsumableArray(_this2.state.content) : _toConsumableArray(_this2.state[_this2.props.filter]);\n\n          _this2.setState({\n            toDisplay: newDisplay\n          });\n        }, 300);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          error = _this$state.error,\n          hasMore = _this$state.hasMore,\n          isLoading = _this$state.isLoading,\n          content = _this$state.content,\n          articles = _this$state.articles,\n          videos = _this$state.videos,\n          comments = _this$state.comments;\n      return (//     <Transition\n        //     items={this.props.filter}\n        //     from={{ opacity: 0 }}\n        //     enter={{ opacity: 1 }}\n        //     leave={{ opacity: 0 }}\n        //     config={config.stiff}\n        //   >\n        //     {show =>\n        //       show &&\n        //       (props => (\n        //         <div style={props}>\n        //           {this.state.toDisplay.map(video => (\n        //             <Fragment key={video.id}>\n        //               <FeedItem\n        //                 id={video.id}\n        //                 date={video.publishDate}\n        //                 img={video.img}\n        //                 title={video.title}\n        //                 description={video.description}\n        //                 comments={comments}\n        //                 filter={this.props.filter}\n        //               />\n        //             </Fragment>\n        //           ))}\n        //         </div>\n        //       ))\n        //     }\n        //   </Transition>\n        React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 230\n          },\n          __self: this\n        }, this.props.filter === \"videos\" ? React.createElement(Transition, {\n          items: this.props.vidFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 242\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (video) {\n              return React.createElement(Fragment, {\n                key: video.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 244\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: video.id,\n                date: video.publishDate,\n                img: video.img,\n                title: video.title,\n                description: video.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 245\n                },\n                __self: this\n              }));\n            }));\n          };\n        }) : this.props.filter === \"articles\" ? React.createElement(Transition, {\n          items: this.props.artFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 261\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 271\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (article) {\n              return React.createElement(Fragment, {\n                key: article.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 273\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: article.id,\n                date: article.publishDate,\n                img: article.img,\n                title: article.title,\n                description: article.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 274\n                },\n                __self: this\n              }));\n            }));\n          };\n        }) : React.createElement(Transition, {\n          items: this.props.latFilter,\n          from: {\n            opacity: 0\n          },\n          enter: {\n            opacity: 1\n          },\n          leave: {\n            opacity: 0\n          },\n          config: config.stiff,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 290\n          },\n          __self: this\n        }, function (show) {\n          return show && function (props) {\n            return React.createElement(\"div\", {\n              style: props,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 300\n              },\n              __self: this\n            }, _this3.state.toDisplay.map(function (content) {\n              return React.createElement(Fragment, {\n                key: content.id,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 302\n                },\n                __self: this\n              }, React.createElement(FeedItem, {\n                id: content.id,\n                date: content.publishDate,\n                img: content.img,\n                title: content.title,\n                description: content.description,\n                comments: comments,\n                filter: _this3.props.filter,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 303\n                },\n                __self: this\n              }));\n            }));\n          };\n        }), error && React.createElement(\"div\", {\n          style: {\n            color: \"#900\"\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 319\n          },\n          __self: this\n        }, error), isLoading && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 320\n          },\n          __self: this\n        }, \"Loading...\"), !hasMore && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 321\n          },\n          __self: this\n        }, \"No more content!\"))\n      );\n    }\n  }]);\n\n  return Feed;\n}(Component);\n\nexport default Feed;","map":{"version":3,"sources":["/Users/danielfeinstat/Desktop/Homework/CodeFoo9-FrontEnd/Front-End---IGN-Code-Foo-9/client/src/components/feed/Feed.js"],"names":["React","Component","Fragment","Transition","animated","config","FeedItem","moment","Feed","props","fetchCommentNumber","commentsurl","i","state","startIndex","content","id","proxyurl","fetch","then","res","json","results","newComments","setState","comments","fetchingComments","reformatDuration","dur","remainder","min","length","loadArticles","isLoading","console","log","data","updateLocale","relativeTime","future","past","s","number","withoutSuffix","key","isFuture","m","mm","h","hh","d","dd","M","MM","y","yy","newContent","map","contentId","contentType","img","thumbnails","url","title","metadata","headline","description","duration","publishDate","fromNow","nextArticles","nextVideos","push","hasMore","articles","videos","catch","err","message","error","toDisplay","window","onscroll","innerHeight","document","documentElement","scrollTop","offsetHeight","prevState","prevProps","filter","setTimeout","newDisplay","vidFilter","opacity","stiff","show","video","artFilter","article","latFilter","color"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { Transition, animated, config } from \"react-spring/renderprops\";\n\nimport FeedItem from \"../feedItem/FeedItem\";\nimport moment from \"moment\";\n\nclass Feed extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      error: false,\n      hasMore: true,\n      isLoading: false,\n      startIndex: 0,\n      //   startIndexArticles: 0,\n      //   startIndexVideos: 0,\n      content: [],\n      articles: [],\n      videos: [],\n      toDisplay: [],\n      comments: [],\n      fetchingComments: false,\n    };\n\n    window.onscroll = () => {\n      const {\n        loadArticles,\n        state: { error, isLoading, hasMore },\n      } = this;\n\n      if (error || isLoading || !hasMore) return;\n\n      if (\n        window.innerHeight + document.documentElement.scrollTop >=\n        document.documentElement.offsetHeight - 60\n      ) {\n        loadArticles();\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.loadArticles();\n  }\n\n  componentDidUpdate(prevState, prevProps) {\n    if (\n      prevState.filter !== this.props.filter ||\n      prevProps.startIndex !== this.state.startIndex\n    ) {\n      setTimeout(() => {\n        let newDisplay =\n          this.props.filter === `latest`\n            ? [...this.state.content]\n            : [...this.state[this.props.filter]];\n        this.setState({\n          toDisplay: newDisplay,\n        });\n      }, 300);\n    }\n  }\n\n  fetchCommentNumber = () => {\n    let commentsurl = `https://ign-apis.herokuapp.com/comments?ids=`;\n    for (let i = this.state.startIndex - 20; i < this.state.startIndex; i++) {\n      if (i + 1 === this.state.startIndex) {\n        commentsurl += `${this.state.content[i].id}`;\n      } else {\n        commentsurl += `${this.state.content[i].id},`;\n      }\n    }\n    const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n    fetch(proxyurl + commentsurl)\n      .then(res => res.json())\n      .then(results => {\n        const newComments = results.content;\n\n        this.setState(state => ({\n          comments: [...state.comments, ...newComments],\n          fetchingComments: false,\n        }));\n      });\n  };\n\n  reformatDuration = dur => {\n    let remainder = dur % 60;\n    let min = (dur - remainder) / 60;\n    if (remainder.length < 2) {\n      return `${min}:0${remainder}`;\n    } else {\n      return `${min}:0${remainder}`;\n    }\n  };\n\n  loadArticles = () => {\n    if (!this.state.fetchingComments) {\n      this.setState({ isLoading: true }, () => {\n        //The api given returns a access-cross-origin-header error.\n        //Therefore I'm using a proxy to convince the api it is sending the data to itself.\n        //I know this is a bit hacky and if I have time after building all the projects I'll try for a more elegant solution.\n        const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n        console.log(\n          proxyurl +\n            `https://ign-apis.herokuapp.com/content?startIndex=${\n              this.state.startIndex\n            }&count=20`\n        );\n        fetch(\n          proxyurl +\n            `https://ign-apis.herokuapp.com/content?startIndex=${\n              this.state.startIndex\n            }&count=20`\n        )\n          // .then(res => console.log(res));\n          .then(res => res.json())\n          .then(results => {\n            console.log(results.data);\n\n            moment.updateLocale(\"en\", {\n              relativeTime: {\n                future: \"in %s\",\n                past: \"%s\",\n                s: function(number, withoutSuffix, key, isFuture) {\n                  return number + \"s\";\n                },\n                m: \"1m\",\n                mm: function(number, withoutSuffix, key, isFuture) {\n                  return number + \"m\";\n                },\n                h: \"1h\",\n                hh: \"%dh\",\n                d: \"1d\",\n                dd: \"%dd\",\n                M: \"1m\",\n                MM: \"%dm\",\n                y: \"1y\",\n                yy: \"%dy\",\n              },\n            });\n            let newContent = results.data.map(content => ({\n              id: content.contentId,\n              contentType: content.contentType,\n              img: content.thumbnails[0].url\n                ? content.thumbnails[0].url\n                : `placeholder`,\n              title: content.metadata.headline,\n              description: content.metadata.title,\n              duration: content.metadata.duration\n                ? this.reformatDuration(content.metadata.duration)\n                : null,\n              //   publishDate: content.metadata.publishDate,\n              publishDate: moment(content.metadata.publishDate).fromNow(),\n              comments: null,\n            }));\n            console.log(results.data[0].thumbnails[0].url);\n            let nextArticles = [];\n            let nextVideos = [];\n            for (let i = 0; i < newContent.length; i++) {\n              if (newContent[i].contentType === \"article\") {\n                nextArticles.push(newContent[i]);\n              } else if (newContent[i].contentType === \"video\") {\n                nextVideos.push(newContent[i]);\n              }\n            }\n            this.setState(\n              state => ({\n                hasMore: state.content.length < 300,\n                isLoading: false,\n                startIndex: state.startIndex + 20,\n                content: [...state.content, ...newContent],\n                articles: [...state.articles, ...nextArticles],\n                videos: [...state.videos, ...nextVideos],\n                fetchingComments: true,\n              }),\n              () => {\n                this.fetchCommentNumber();\n              }\n            );\n          })\n          .catch(err => {\n            this.setState({\n              err: err.message,\n              isLoading: false,\n            });\n          });\n      });\n    }\n  };\n\n  render() {\n    const {\n      error,\n      hasMore,\n      isLoading,\n      content,\n      articles,\n      videos,\n      comments,\n    } = this.state;\n    return (\n      //     <Transition\n      //     items={this.props.filter}\n      //     from={{ opacity: 0 }}\n      //     enter={{ opacity: 1 }}\n      //     leave={{ opacity: 0 }}\n      //     config={config.stiff}\n      //   >\n      //     {show =>\n      //       show &&\n      //       (props => (\n      //         <div style={props}>\n      //           {this.state.toDisplay.map(video => (\n      //             <Fragment key={video.id}>\n      //               <FeedItem\n      //                 id={video.id}\n      //                 date={video.publishDate}\n      //                 img={video.img}\n      //                 title={video.title}\n      //                 description={video.description}\n      //                 comments={comments}\n      //                 filter={this.props.filter}\n      //               />\n      //             </Fragment>\n      //           ))}\n      //         </div>\n      //       ))\n      //     }\n      //   </Transition>\n      <div>\n        {this.props.filter === `videos` ? (\n          <Transition\n            items={this.props.vidFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(video => (\n                    <Fragment key={video.id}>\n                      <FeedItem\n                        id={video.id}\n                        date={video.publishDate}\n                        img={video.img}\n                        title={video.title}\n                        description={video.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        ) : this.props.filter === `articles` ? (\n          <Transition\n            items={this.props.artFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(article => (\n                    <Fragment key={article.id}>\n                      <FeedItem\n                        id={article.id}\n                        date={article.publishDate}\n                        img={article.img}\n                        title={article.title}\n                        description={article.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        ) : (\n          <Transition\n            items={this.props.latFilter}\n            from={{ opacity: 0 }}\n            enter={{ opacity: 1 }}\n            leave={{ opacity: 0 }}\n            config={config.stiff}\n          >\n            {show =>\n              show &&\n              (props => (\n                <div style={props}>\n                  {this.state.toDisplay.map(content => (\n                    <Fragment key={content.id}>\n                      <FeedItem\n                        id={content.id}\n                        date={content.publishDate}\n                        img={content.img}\n                        title={content.title}\n                        description={content.description}\n                        comments={comments}\n                        filter={this.props.filter}\n                      />\n                    </Fragment>\n                  ))}\n                </div>\n              ))\n            }\n          </Transition>\n        )}\n        {error && <div style={{ color: \"#900\" }}>{error}</div>}\n        {isLoading && <div>Loading...</div>}\n        {!hasMore && <div>No more content!</div>}\n      </div>\n    );\n  }\n}\n\nexport default Feed;\n"]},"metadata":{},"sourceType":"module"}